(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{48312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(78827)}])},78827:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return tL},default:function(){return tG}});var l,a,s,n,o=r(85893),i=r(67294),d=r(88767),c=r(61162),u=r(9008),x=r.n(u);let m=e=>{let{initialState:t}=e,r=(e,r)=>{if(!r.type)return{...e,[r.field]:r.value};if("reset"===r.type)return t;throw Error()},[l,a]=(0,i.useReducer)(r,t);return(0,i.useMemo)(()=>({state:l,dispatch:a}),[l,a])},p=()=>{let{t:e}=(0,c.$G)("chat");return{getModelsError:(0,i.useMemo)(()=>t=>t?{title:e("Error fetching models."),code:t.status||"unknown",messageLines:t.statusText?[t.statusText]:[e("Make sure your OpenAI API key is set in the bottom left of the sidebar."),e("If you completed this step, OpenAI may be experiencing issues.")]}:null,[e])}},h=()=>{let e=async(e,t,r)=>{let l=(null==t?void 0:t.params)?"".concat(e).concat(t.params):e,a=(null==t?void 0:t.body)?t.body instanceof FormData?{...t,body:t.body}:{...t,body:JSON.stringify(t.body)}:t,s={...(null==t?void 0:t.headers)?t.headers:(null==t?void 0:t.body)&&t.body instanceof FormData?{}:{"Content-type":"application/json"}};return fetch(l,{...a,headers:s,signal:r}).then(e=>{if(!e.ok)throw e;let t=e.headers.get("content-type"),r=e.headers.get("content-disposition");e.headers;let l=t&&((null==t?void 0:t.indexOf("application/json"))!==-1||(null==t?void 0:t.indexOf("text/plain"))!==-1)?e.json():(null==r?void 0:r.indexOf("attachment"))!==-1?e.blob():e;return l}).catch(async e=>{let t=e.headers.get("content-type"),r=t&&(null==t?void 0:t.indexOf("application/problem+json"))!==-1?await e.json():e;throw r})};return{get:async(t,r)=>e(t,{...r,method:"get"}),post:async(t,r)=>e(t,{...r,method:"post"}),put:async(t,r)=>e(t,{...r,method:"put"}),patch:async(t,r)=>e(t,{...r,method:"patch"}),delete:async(t,r)=>e(t,{...r,method:"delete"})}},f=()=>{let e=h(),t=(0,i.useCallback)((t,r)=>e.post("/api/models",{body:{key:t.key},headers:{"Content-Type":"application/json"},signal:r}),[e]);return{getModels:t}};(l=a||(a={})).GPT_3_5="gpt-3.5-turbo",l.GPT_3_5_AZ="gpt-35-turbo",l.GPT_4="gpt-4",l.GPT_4_32K="gpt-4-32k",a.GPT_3_5;let g={[a.GPT_3_5]:{id:a.GPT_3_5,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.GPT_3_5_AZ]:{id:a.GPT_3_5_AZ,name:"GPT-3.5",maxLength:12e3,tokenLimit:4e3},[a.GPT_4]:{id:a.GPT_4,name:"GPT-4",maxLength:24e3,tokenLimit:8e3},[a.GPT_4_32K]:{id:a.GPT_4_32K,name:"GPT-4-32K",maxLength:96e3,tokenLimit:32e3}};var v=r(83454);let b=v.env.NEXT_PUBLIC_DEFAULT_SYSTEM_PROMPT||"You are ChatGPT, a large language model trained by OpenAI. Follow the user's instructions carefully. Respond using markdown.";v.env.OPENAI_API_HOST,v.env.OPENAI_API_TYPE,v.env.OPENAI_API_VERSION,v.env.OPENAI_ORGANIZATION,v.env.GPT_4_URL,v.env.SITE;let j=e=>{let t=e;return t.model||(t={...t,model:t.model||g[a.GPT_3_5]}),t.prompt||(t={...t,prompt:t.prompt||b}),t.folderId||(t={...t,folderId:t.folderId||null}),t},y=e=>Array.isArray(e)?e.reduce((e,t)=>{try{t.model||(t.model=g[a.GPT_3_5]),t.prompt||(t.prompt=b),t.folderId||(t.folderId=null),e.push(t)}catch(e){console.warn("error while cleaning conversations' history. Removing culprit",e)}return e},[]):(console.warn("history is not an array. Returning an empty array."),[]),w=(e,t)=>{let r=t.map(t=>t.id===e.id?e:t);return k(e),N(r),{single:e,all:r}},k=e=>{localStorage.setItem("selectedConversation",JSON.stringify(e))},N=e=>{localStorage.setItem("conversationHistory",JSON.stringify(e))},C=e=>{localStorage.setItem("folders",JSON.stringify(e))},_=e=>{localStorage.setItem("prompts",JSON.stringify(e))};var S=r(33111),I=r(51668),P=r(63072),E=r(86501);(s||(s={})).GOOGLE_SEARCH="google-search",(n||(n={})).GOOGLE_SEARCH="Google Search";let T={[s.GOOGLE_SEARCH]:{id:s.GOOGLE_SEARCH,name:n.GOOGLE_SEARCH,requiredKeys:[{key:"GOOGLE_API_KEY",value:""},{key:"GOOGLE_CSE_ID",value:""}]}},Z=Object.values(T),O=e=>e&&e.id===s.GOOGLE_SEARCH?"api/google":"api/chat",G=(0,i.createContext)(void 0);var L=r(85158),z=r(55155),D=r(93625),A=r(48669),R=r.n(A),K=r(20640),U=r.n(K);let M=e=>{let{}=e,{t}=(0,c.$G)("chat"),{state:{userInfo:r,models:l}}=(0,i.useContext)(G),[s,n]=(0,i.useState)(!1);return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600 dark:text-gray-100 text-gray-800",children:[(0,o.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:t("Site Note")}),(0,o.jsxs)("ul",{className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",children:[(0,o.jsxs)("li",{children:["1. ",t("This website aims to provide the most authentic ChatGPT experience possible. Join our group to communicate with others"),"（",(0,o.jsx)("a",{href:"//resource.close-ai.work/qq_group.jpeg",target:"_blank",className:"inline underline text-white",children:t("QQ Group")}),"\xa0\xa0\xa0\xa0",(0,o.jsx)("a",{href:"//resource.close-ai.work/wechat_group.jpeg",target:"_blank",className:"inline underline text-white",children:t("Wechat Group")}),"）"]}),l.find(e=>e.id===a.GPT_4)&&(0,o.jsxs)("li",{children:["2. 【",t("Breaking News"),"】",t("Our website is the first to release GPT-4. Please select GPT-4 in the model section. For pricing, please refer to the recharge page")]}),l.find(e=>e.id===a.GPT_4)&&(0,o.jsxs)("li",{children:["3. 【",t("Breaking News"),"】",t("Price Change",{beforeRequest:20,afterRequest:40,beforeResponse:40,afterResponse:80})]})]}),(null==r?void 0:r.authCode)&&(0,o.jsxs)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",children:[t("Auth code")," ",(0,o.jsxs)("code",{className:R().code,children:[s?null==r?void 0:r.authCode:null==r?void 0:r.authCode.replace(/\S/g,"*"),(0,o.jsx)("span",{onClick:()=>n(!s),style:{marginLeft:4,cursor:"pointer"},children:s?(0,o.jsx)(L.Z,{className:R().inlineIcon,size:18}):(0,o.jsx)(z.Z,{className:R().inlineIcon,size:18})}),(0,o.jsx)("span",{onClick:()=>{U()(null==r?void 0:r.authCode)&&E.ZP.success(t("Copy Success"))},style:{marginLeft:4,cursor:"pointer"},children:(0,o.jsx)(D.Z,{className:R().inlineIcon,size:18})})]})," ",t("Confirm AuthCode")]})]})})},F=e=>{let{size:t="1em",className:r=""}=e;return(0,o.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin ".concat(r),height:t,width:t,xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("line",{x1:"12",y1:"2",x2:"12",y2:"6"}),(0,o.jsx)("line",{x1:"12",y1:"18",x2:"12",y2:"22"}),(0,o.jsx)("line",{x1:"4.93",y1:"4.93",x2:"7.76",y2:"7.76"}),(0,o.jsx)("line",{x1:"16.24",y1:"16.24",x2:"19.07",y2:"19.07"}),(0,o.jsx)("line",{x1:"2",y1:"12",x2:"6",y2:"12"}),(0,o.jsx)("line",{x1:"18",y1:"12",x2:"22",y2:"12"}),(0,o.jsx)("line",{x1:"4.93",y1:"19.07",x2:"7.76",y2:"16.24"}),(0,o.jsx)("line",{x1:"16.24",y1:"7.76",x2:"19.07",y2:"4.93"})]})};var J=r(21223),$=r(19695),H=r(59348),W=r(23461);let B=e=>{let{plugin:t,onPluginChange:r,onKeyDown:l}=e,{t:a}=(0,c.$G)("chat"),s=(0,i.useRef)(null),n=e=>{let t=s.current,a=(null==t?void 0:t.options.length)||0;"/"===e.key&&e.metaKey?(e.preventDefault(),t&&(t.selectedIndex=(t.selectedIndex+1)%a,t.dispatchEvent(new Event("change")))):"/"===e.key&&e.shiftKey&&e.metaKey?(e.preventDefault(),t&&(t.selectedIndex=(t.selectedIndex-1+a)%a,t.dispatchEvent(new Event("change")))):"Enter"===e.key?(e.preventDefault(),t&&t.dispatchEvent(new Event("change")),r(Z.find(e=>e.name===(null==t?void 0:t.selectedOptions[0].innerText)))):l(e)};return(0,i.useEffect)(()=>{s.current&&s.current.focus()},[]),(0,o.jsx)("div",{className:"flex flex-col",children:(0,o.jsx)("div",{className:"mb-1 w-full rounded border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,o.jsxs)("select",{ref:s,className:"w-full cursor-pointer bg-transparent p-2",placeholder:a("Select a plugin")||"",value:(null==t?void 0:t.id)||"",onChange:e=>{r(Z.find(t=>t.id===e.target.value))},onKeyDown:e=>{n(e)},children:[(0,o.jsx)("option",{value:"chatgpt",className:"dark:bg-[#343541] dark:text-white",children:"ChatGPT"},"chatgpt"),Z.map(e=>(0,o.jsx)("option",{value:e.id,className:"dark:bg-[#343541] dark:text-white",children:e.name},e.id))]})})})},q=e=>{let{prompts:t,activePromptIndex:r,onSelect:l,onMouseOver:a,promptListRef:s}=e;return(0,o.jsx)("ul",{ref:s,className:"z-10 max-h-52 w-full overflow-scroll rounded border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-neutral-500 dark:bg-[#343541] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)]",children:t.map((e,t)=>(0,o.jsx)("li",{className:"".concat(t===r?"bg-gray-200 dark:bg-[#202123] dark:text-black":""," cursor-pointer px-3 py-2 text-sm text-black dark:text-white"),onClick:e=>{e.preventDefault(),e.stopPropagation(),l()},onMouseEnter:()=>a(t),children:e.name},e.id))})},Y=e=>{let{prompt:t,variables:r,onSubmit:l,onClose:a}=e,[s,n]=(0,i.useState)(r.map(e=>({key:e,value:""})).filter((e,t,r)=>r.findIndex(t=>t.key===e.key)===t)),d=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(e,t)=>{n(r=>{let l=[...r];return l[e].value=t,l})},x=()=>{if(s.some(e=>""===e.value)){alert("Please fill out all variables");return}l(s.map(e=>e.value)),a()},m=e=>{"Enter"!==e.key||e.shiftKey?"Escape"===e.key&&a():(e.preventDefault(),x())};return(0,i.useEffect)(()=>{let e=e=>{d.current&&!d.current.contains(e.target)&&a()};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[a]),(0,i.useEffect)(()=>{c.current&&c.current.focus()},[]),(0,o.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",onKeyDown:m,children:(0,o.jsxs)("div",{ref:d,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,o.jsx)("div",{className:"mb-4 text-xl font-bold text-black dark:text-neutral-200",children:t.name}),(0,o.jsx)("div",{className:"mb-4 text-sm italic text-black dark:text-neutral-200",children:t.description}),s.map((e,t)=>(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsx)("div",{className:"mb-2 text-sm font-bold text-neutral-200",children:e.key}),(0,o.jsx)("textarea",{ref:0===t?c:void 0,className:"mt-1 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:"Enter a value for ".concat(e.key,"..."),value:e.value,onChange:e=>u(t,e.target.value),rows:3})]},t)),(0,o.jsx)("button",{className:"mt-6 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:x,children:"Submit"})]})})};var V=r(86010);let X=e=>{var t;let{onSend:r,onRegenerate:l,stopConversationRef:a,textareaRef:s}=e,{t:n}=(0,c.$G)("chat"),{state:{inited:d,selectedConversation:u,messageIsStreaming:x,prompts:m},dispatch:p}=(0,i.useContext)(G),[h,f]=(0,i.useState)(),[g,v]=(0,i.useState)(!1),[b,j]=(0,i.useState)(!1),[y,w]=(0,i.useState)(0),[k,N]=(0,i.useState)(""),[C,_]=(0,i.useState)([]),[S,I]=(0,i.useState)(!1),[P,E]=(0,i.useState)(!1),[T,Z]=(0,i.useState)(null),O=(0,i.useRef)(null),L=m.filter(e=>e.name.toLowerCase().includes(k.toLowerCase())),z=e=>{let t=e.target.value,r=null==u?void 0:u.model.maxLength;if(r&&t.length>r){alert(n("Message limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:r,valueLength:t.length}));return}f(t),X(t)},D=()=>{if(!x){if(!h){alert(n("Please enter a message"));return}r({role:"user",content:h},T),f(""),Z(null),window.innerWidth<640&&s&&s.current&&s.current.blur()}},A=()=>{let e=void 0===window.navigator?"":navigator.userAgent;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile|mobile|CriOS/i.test(e)},K=()=>{let e=L[y];e&&(f(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),Q(e)),j(!1)},U=e=>{b?"ArrowDown"===e.key?(e.preventDefault(),w(e=>e<m.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),w(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),w(e=>e<m.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),K()):"Escape"===e.key?(e.preventDefault(),j(!1)):w(0):"Enter"!==e.key||g||A()||e.shiftKey?"/"===e.key&&e.metaKey&&(e.preventDefault(),E(!P)):(e.preventDefault(),D())},M=e=>{let t;let r=/{{(.*?)}}/g,l=[];for(;null!==(t=r.exec(e));)l.push(t[1]);return l},X=(0,i.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(j(!0),N(t[0].slice(1))):(j(!1),N(""))},[]),Q=e=>{let t=M(e.content);_(t),t.length>0?I(!0):(f(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),X(e.content))},ee=e=>{let t=null==h?void 0:h.replace(/{{(.*?)}}/g,(t,r)=>{let l=C.indexOf(r);return e[l]});f(t),s&&s.current&&s.current.focus()};return(0,i.useEffect)(()=>{O.current&&(O.current.scrollTop=30*y)},[y]),(0,i.useEffect)(()=>{if(s&&s.current){var e,t;s.current.style.height="inherit",s.current.style.height="".concat(null===(e=s.current)||void 0===e?void 0:e.scrollHeight,"px"),s.current.style.overflow="".concat((null==s?void 0:null===(t=s.current)||void 0===t?void 0:t.scrollHeight)>400?"auto":"hidden")}},[h]),(0,i.useEffect)(()=>{let e=e=>{O.current&&!O.current.contains(e.target)&&j(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,o.jsx)("div",{className:"absolute bottom-0 left-0 w-full border-transparent bg-gradient-to-b from-transparent via-white to-white pt-6 dark:border-white/20 dark:via-[#343541] dark:to-[#343541] md:pt-2",children:(0,o.jsxs)("div",{className:(0,V.Z)(R().safe,"stretch mx-2 mt-4 flex flex-row gap-3 last:mb-2 md:mx-4 md:mt-[52px] md:last:mb-6 lg:mx-auto lg:max-w-3xl"),children:[u&&u.messages.length>0&&(0,o.jsxs)("button",{className:"absolute top-0 left-0 right-0 mx-auto mb-3 flex w-fit items-center gap-3 rounded border border-neutral-200 bg-white py-2 px-4 text-black hover:opacity-50 dark:border-neutral-600 dark:bg-[#343541] dark:text-white md:mb-0 md:mt-2",onClick:l,disabled:x,children:[x?(0,o.jsx)(F,{size:"16px",className:"inline mx-auto"}):(0,o.jsx)(J.Z,{size:16}),n("Regenerate response")]}),(0,o.jsxs)("div",{className:"relative mx-2 flex w-full flex-grow flex-col rounded-md border border-black/10 bg-white shadow-[0_0_10px_rgba(0,0,0,0.10)] dark:border-gray-900/50 dark:bg-[#40414F] dark:text-white dark:shadow-[0_0_15px_rgba(0,0,0,0.10)] sm:mx-4",children:[(0,o.jsx)("button",{className:"absolute left-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:()=>{},onKeyDown:e=>{},children:T?(0,o.jsx)($.Z,{size:20}):(0,o.jsx)(H.Z,{size:20})}),!d&&(0,o.jsx)("span",{className:R().textareaLoading,children:(0,o.jsx)(F,{size:"16px",className:"inline mx-auto"})}),P&&(0,o.jsx)("div",{className:"absolute left-0 bottom-14 rounded bg-white dark:bg-[#343541]",children:(0,o.jsx)(B,{plugin:T,onKeyDown:e=>{if("Escape"===e.key){var t;e.preventDefault(),E(!1),null===(t=s.current)||void 0===t||t.focus()}},onPluginChange:e=>{Z(e),E(!1),s&&s.current&&s.current.focus()}})}),(0,o.jsx)("textarea",{ref:s,disabled:!d,className:"m-0 w-full resize-none border-0 bg-transparent p-0 py-2 pr-8 pl-10 text-black dark:bg-transparent dark:text-white md:py-3 md:pl-10",style:{resize:"none",bottom:"".concat(null==s?void 0:null===(t=s.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"400px",paddingLeft:d?void 0:"calc(2.5rem + 16px + 4px)",overflow:"".concat(s.current&&s.current.scrollHeight>400?"auto":"hidden")},placeholder:n('Type a message or type "/" to select a prompt...')||"",value:h,rows:1,onCompositionStart:()=>v(!0),onCompositionEnd:()=>v(!1),onChange:z,onKeyDown:U}),(0,o.jsx)("button",{className:"absolute right-2 top-2 rounded-sm p-1 text-neutral-800 opacity-60 hover:bg-neutral-200 hover:text-neutral-900 dark:bg-opacity-50 dark:text-neutral-100 dark:hover:text-neutral-200",onClick:D,children:x?(0,o.jsx)("div",{className:"h-4 w-4 animate-spin rounded-full border-t-2 border-neutral-800 opacity-60 dark:border-neutral-100"}):(0,o.jsx)(W.Z,{size:18})}),b&&L.length>0&&(0,o.jsx)("div",{className:"absolute bottom-12 w-full",children:(0,o.jsx)(q,{activePromptIndex:y,prompts:L,onSelect:K,onMouseOver:w,promptListRef:O})}),S&&(0,o.jsx)(Y,{prompt:m[y],variables:C,onSubmit:ee,onClose:()=>I(!1)})]})]})})};var Q=r(90553),ee=r(10614);let et=()=>(0,o.jsx)("div",{className:"group border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100",style:{overflowWrap:"anywhere"},children:(0,o.jsxs)("div",{className:"m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,o.jsx)("div",{className:"min-w-[40px] items-end",children:(0,o.jsx)(Q.Z,{size:30})}),(0,o.jsx)(ee.Z,{className:"animate-pulse"})]})});var er=r(8861),el=r(21942),ea=r(74075),es=r(88198),en=r(67828),eo=r(80335),ei=r(93179),ed=r(84283);let ec={javascript:".js",python:".py",java:".java",c:".c",cpp:".cpp","c++":".cpp","c#":".cs",ruby:".rb",php:".php",swift:".swift","objective-c":".m",kotlin:".kt",typescript:".ts",go:".go",perl:".pl",rust:".rs",scala:".scala",haskell:".hs",lua:".lua",shell:".sh",sql:".sql",html:".html",css:".css"},eu=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="ABCDEFGHJKLMNPQRSTUVWXY3456789",l="";for(let t=0;t<e;t++)l+=r.charAt(Math.floor(Math.random()*r.length));return t?l.toLowerCase():l},ex=(0,i.memo)(e=>{let{language:t,value:r}=e,{t:l}=(0,c.$G)("markdown"),[a,s]=(0,i.useState)(!1),n=()=>{navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(r).then(()=>{s(!0),setTimeout(()=>{s(!1)},2e3)})},d=()=>{let e=ec[t]||".file",a="file-".concat(eu(3,!0)).concat(e),s=window.prompt(l("Enter file name")||"",a);if(!s)return;let n=new Blob([r],{type:"text/plain"}),o=URL.createObjectURL(n),i=document.createElement("a");i.download=s,i.href=o,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,o.jsxs)("div",{className:"codeblock relative font-sans text-[16px]",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between py-1.5 px-4",children:[(0,o.jsx)("span",{className:"text-xs lowercase text-white",children:t}),(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("button",{className:"flex gap-1.5 items-center rounded bg-none p-1 text-xs text-white",onClick:n,children:[a?(0,o.jsx)(es.Z,{size:18}):(0,o.jsx)(en.Z,{size:18}),a?l("Copied!"):l("Copy code")]}),(0,o.jsx)("button",{className:"flex items-center rounded bg-none p-1 text-xs text-white",onClick:d,children:(0,o.jsx)(eo.Z,{size:18})})]})]}),(0,o.jsx)(ei.Z,{language:t,style:ed.vk,customStyle:{margin:0},children:r})]})});ex.displayName="CodeBlock";var em=r(16202);let ep=(0,i.memo)(em.D);var eh=r(45884),ef=r(29758),eg=r(30399);let ev=(0,i.memo)(e=>{let{message:t,messageIndex:r}=e,{t:l}=(0,c.$G)("chat"),{state:{selectedConversation:a,conversations:s,currentMessage:n},dispatch:d}=(0,i.useContext)(G),[u,x]=(0,i.useState)(!1),[m,p]=(0,i.useState)(!1),[h,f]=(0,i.useState)(t.content),[g,v]=(0,i.useState)(!1),b=(0,i.useRef)(null),j=()=>{x(!u)},y=e=>{f(e.target.value),b.current&&(b.current.style.height="inherit",b.current.style.height="".concat(b.current.scrollHeight,"px"))},k=()=>{if(t.content!=h&&a){let e=a.messages.map((e,t)=>{if(t<r)return e}).filter(e=>e),l={...a,messages:e},{single:n,all:o}=w(l,s);d({field:"selectedConversation",value:n}),d({field:"conversations",value:o}),d({field:"currentMessage",value:{...t,content:h}})}x(!1)},N=()=>{if(!a)return;let{messages:e}=a,r=e.findIndex(e=>e===t);if(r<0)return;r<e.length-1&&"assistant"===e[r+1].role?e.splice(r,2):e.splice(r,1);let l={...a,messages:e},{single:n,all:o}=w(l,s);d({field:"selectedConversation",value:n}),d({field:"conversations",value:o})},C=e=>{"Enter"!==e.key||m||e.shiftKey||(e.preventDefault(),k())},_=()=>{navigator.clipboard&&navigator.clipboard.writeText(t.content).then(()=>{v(!0),setTimeout(()=>{v(!1)},2e3)})};return(0,i.useEffect)(()=>{b.current&&(b.current.style.height="inherit",b.current.style.height="".concat(b.current.scrollHeight,"px"))},[u]),(0,o.jsx)("div",{className:"group px-4 ".concat("assistant"===t.role?"border-b border-black/10 bg-gray-50 text-gray-800 dark:border-gray-900/50 dark:bg-[#444654] dark:text-gray-100":"border-b border-black/10 bg-white text-gray-800 dark:border-gray-900/50 dark:bg-[#343541] dark:text-gray-100"),style:{overflowWrap:"anywhere"},children:(0,o.jsxs)("div",{className:"relative m-auto flex gap-4 p-4 text-base md:max-w-2xl md:gap-6 md:py-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:[(0,o.jsx)("div",{className:"min-w-[40px] text-right font-bold",children:"assistant"===t.role?(0,o.jsx)(Q.Z,{size:30}):(0,o.jsx)(er.Z,{size:30})}),(0,o.jsx)("div",{className:"prose mt-[-2px] w-full dark:prose-invert",children:"user"===t.role?(0,o.jsxs)("div",{className:"flex w-full",children:[u?(0,o.jsxs)("div",{className:"flex w-full flex-col",children:[(0,o.jsx)("textarea",{ref:b,className:"w-full resize-none whitespace-pre-wrap border-none dark:bg-[#343541]",value:h,onChange:y,onKeyDown:C,onCompositionStart:()=>p(!0),onCompositionEnd:()=>p(!1),style:{fontFamily:"inherit",fontSize:"inherit",lineHeight:"inherit",padding:"0",margin:"0",overflow:"hidden"}}),(0,o.jsxs)("div",{className:"mt-10 flex justify-center space-x-4",children:[(0,o.jsx)("button",{className:"h-[40px] rounded-md bg-blue-500 px-4 py-1 text-sm font-medium text-white enabled:hover:bg-blue-600 disabled:opacity-50",onClick:k,disabled:h.trim().length<=0,children:l("Save & Submit")}),(0,o.jsx)("button",{className:"h-[40px] rounded-md border border-neutral-300 px-4 py-1 text-sm font-medium text-neutral-700 hover:bg-neutral-100 dark:border-neutral-700 dark:text-neutral-300 dark:hover:bg-neutral-800",onClick:()=>{f(t.content),x(!1)},children:l("Cancel")})]})]}):(0,o.jsx)("div",{className:"prose whitespace-pre-wrap dark:prose-invert",children:t.content}),(window.innerWidth<640||!u)&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"absolute translate-x-[1000px] text-gray-500 hover:text-gray-700 focus:translate-x-0 group-hover:translate-x-0 dark:text-gray-400 dark:hover:text-gray-300 ".concat(window.innerWidth<640?"bottom-1 right-3":"right-6 top-[26px]","\n                      "),onClick:j,children:(0,o.jsx)(el.Z,{size:20})}),(0,o.jsx)("button",{className:"absolute translate-x-[1000px] text-gray-500 hover:text-gray-700 focus:translate-x-0 group-hover:translate-x-0 dark:text-gray-400 dark:hover:text-gray-300 ".concat(window.innerWidth<640?"bottom-1 right-3":"right-0 top-[26px]","\n                      "),onClick:N,children:(0,o.jsx)(ea.Z,{size:20})})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"absolute ".concat(window.innerWidth<640?"bottom-1 right-3":"right-0 top-[26px] m-0"),children:g?(0,o.jsx)(es.Z,{size:20,className:"text-green-500 dark:text-green-400"}):(0,o.jsx)("button",{className:"translate-x-[1000px] text-gray-500 hover:text-gray-700 focus:translate-x-0 group-hover:translate-x-0 dark:text-gray-400 dark:hover:text-gray-300",onClick:_,children:(0,o.jsx)(D.Z,{size:20})})}),(0,o.jsx)(ep,{className:"prose dark:prose-invert",remarkPlugins:[ef.Z,eg.Z],rehypePlugins:[eh.Z],components:{code(e){let{node:t,inline:r,className:l,children:a,...s}=e,n=/language-(\w+)/.exec(l||"");return r?(0,o.jsx)("code",{className:l,...s,children:a}):(0,o.jsx)(ex,{language:n&&n[1]||"",value:String(a).replace(/\n$/,""),...s},Math.random())},table(e){let{children:t}=e;return(0,o.jsx)("table",{className:"border-collapse border border-black px-3 py-1 dark:border-white",children:t})},th(e){let{children:t}=e;return(0,o.jsx)("th",{className:"break-words border border-black bg-gray-500 px-3 py-1 text-white dark:border-white",children:t})},td(e){let{children:t}=e;return(0,o.jsx)("td",{className:"break-words border border-black px-3 py-1 dark:border-white",children:t})}},children:t.content})]})})]})})});ev.displayName="ChatMessage";var eb=r(58403);let ej=e=>{let{error:t}=e;return(0,o.jsxs)("div",{className:"mx-6 flex h-full flex-col items-center justify-center text-red-500",children:[(0,o.jsx)("div",{className:"mb-5",children:(0,o.jsx)(eb.Z,{size:36})}),(0,o.jsx)("div",{className:"mb-3 text-2xl font-medium",children:t.title}),t.messageLines.map((e,t)=>(0,o.jsxs)("div",{className:"text-center",children:[" ",e," "]},t)),(0,o.jsx)("div",{className:"mt-4 text-xs opacity-50 dark:text-red-400",children:t.code?(0,o.jsxs)("i",{children:["Code: ",t.code]}):""})]})},ey=e=>{let{models:t,userInfo:r,defaultModelId:l}=e,{t:s}=(0,c.$G)("common"),n=(0,i.useMemo)(()=>l&&g[l],[l]),o=e=>"number"==typeof(null==r?void 0:r.amount)&&r.amount<10&&(null==e?void 0:e.model.id)===a.GPT_4,d=(0,i.useCallback)(e=>!t.length||!!t.find(t=>t.id===e.model.id),[t]),u=()=>{(0,E.ZP)(s("Limit GPT-4"),{icon:"⚠️",duration:5e3,position:"top-right"})};return{defaultModel:n,isForbiddenGPT4:o,isSupportGPT4:d,warnGPT4:u}},ew=()=>{var e;let{t}=(0,c.$G)("chat"),{state:{selectedConversation:r,userInfo:l,models:s,defaultModelId:n},handleUpdateConversation:d}=(0,i.useContext)(G),{warnGPT4:u,isForbiddenGPT4:x}=ey({models:s,userInfo:l,defaultModelId:n}),m=e=>{if(x({model:{id:e.target.value}})){u();return}r&&d(r,{key:"model",value:s.find(t=>t.id===e.target.value)})};return(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsxs)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:[t("Model")," ",s.find(e=>e.id===a.GPT_4)?"(".concat(t("Supported")," GPT-4)"):""]}),(0,o.jsx)("div",{className:"w-full rounded-lg border border-neutral-200 bg-transparent pr-2 text-neutral-900 dark:border-neutral-600 dark:text-white",children:(0,o.jsx)("select",{className:"w-full bg-transparent p-2",placeholder:t("Select a model")||"",value:(null==r?void 0:null===(e=r.model)||void 0===e?void 0:e.id)||n,onChange:m,children:s.map(e=>(0,o.jsx)("option",{value:e.id,className:"dark:bg-[#343541] dark:text-white",children:e.id===n?"".concat(e.name," (").concat(t("Default"),")"):e.name},e.id))})})]})},ek=e=>{var t;let{conversation:r,prompts:l,onChangePrompt:a}=e,{t:s}=(0,c.$G)("chat"),[n,d]=(0,i.useState)(""),[u,x]=(0,i.useState)(0),[m,p]=(0,i.useState)(!1),[h,f]=(0,i.useState)(""),[g,v]=(0,i.useState)([]),[j,y]=(0,i.useState)(!1),w=(0,i.useRef)(null),k=(0,i.useRef)(null),N=l.filter(e=>e.name.toLowerCase().includes(h.toLowerCase())),C=e=>{let t=e.target.value,l=r.model.maxLength;if(t.length>l){alert(s("Prompt limit is {{maxLength}} characters. You have entered {{valueLength}} characters.",{maxLength:l,valueLength:t.length}));return}d(t),I(t),t.length>0&&a(t)},_=()=>{let e=N[u];d(t=>{let r=null==t?void 0:t.replace(/\/\w*$/,e.content);return r}),P(e),p(!1)},S=e=>{let t;let r=/{{(.*?)}}/g,l=[];for(;null!==(t=r.exec(e));)l.push(t[1]);return l},I=(0,i.useCallback)(e=>{let t=e.match(/\/\w*$/);t?(p(!0),f(t[0].slice(1))):(p(!1),f(""))},[]),P=e=>{let t=S(e.content);if(v(t),t.length>0)y(!0);else{let t=null==n?void 0:n.replace(/\/\w*$/,e.content);d(t),a(t),I(e.content)}},E=e=>{let t=null==n?void 0:n.replace(/{{(.*?)}}/g,(t,r)=>{let l=g.indexOf(r);return e[l]});d(t),a(t),w&&w.current&&w.current.focus()},T=e=>{m&&("ArrowDown"===e.key?(e.preventDefault(),x(e=>e<l.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),x(e=>e>0?e-1:e)):"Tab"===e.key?(e.preventDefault(),x(e=>e<l.length-1?e+1:0)):"Enter"===e.key?(e.preventDefault(),_()):"Escape"===e.key?(e.preventDefault(),p(!1)):x(0))};return(0,i.useEffect)(()=>{if(w&&w.current){var e;w.current.style.height="inherit",w.current.style.height="".concat(null===(e=w.current)||void 0===e?void 0:e.scrollHeight,"px")}},[n]),(0,i.useEffect)(()=>{r.prompt?d(r.prompt):d(b)},[r]),(0,i.useEffect)(()=>{let e=e=>{k.current&&!k.current.contains(e.target)&&p(!1)};return window.addEventListener("click",e),()=>{window.removeEventListener("click",e)}},[]),(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("label",{className:"mb-2 text-left text-neutral-700 dark:text-neutral-400",children:s("System Prompt")}),(0,o.jsx)("textarea",{ref:w,className:"w-full rounded-lg border border-neutral-200 bg-transparent px-4 py-3 text-neutral-900 dark:border-neutral-600 dark:text-neutral-100",style:{resize:"none",bottom:"".concat(null==w?void 0:null===(t=w.current)||void 0===t?void 0:t.scrollHeight,"px"),maxHeight:"300px",overflow:"".concat(w.current&&w.current.scrollHeight>400?"auto":"hidden")},placeholder:s('Enter a prompt or type "/" to select a prompt...')||"",value:s(n)||"",rows:1,onChange:C,onKeyDown:T}),m&&N.length>0&&(0,o.jsx)("div",{children:(0,o.jsx)(q,{activePromptIndex:u,prompts:N,onSelect:_,onMouseOver:x,promptListRef:k})}),j&&(0,o.jsx)(Y,{prompt:l[u],variables:g,onSubmit:E,onClose:()=>y(!1)})]})},eN=()=>{let e=h(),{t}=(0,c.$G)("common"),{dispatch:r}=(0,i.useContext)(G),[l,a]=(0,i.useState)(!1),s=(0,i.useCallback)((t,r)=>{var l;return e.post("/api/user",{body:{authcode:null!==(l=t.key)&&void 0!==l?l:""},headers:{"Content-Type":"application/json"},signal:r})},[e]),n=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:localStorage.getItem("authCode");a(!0);try{let t=await s({key:e});return r({field:"userInfo",value:null!=t?t:null}),a(!1),t}catch(e){r({field:"userInfo",value:null}),a(!1)}};return{loading:l,fetchUser:n}},eC=(0,i.memo)(e=>{let t,r,{stopConversationRef:l}=e,{t:a}=(0,c.$G)("chat"),{fetchUser:s}=eN(),{state:{closeSite:n,selectedConversation:d,conversations:u,models:x,apiKey:m,pluginKeys:p,serverSideApiKeyIsSet:h,messageIsStreaming:f,modelError:g,loading:v,prompts:b,userInfo:j},handleUpdateConversation:y,dispatch:C}=(0,i.useContext)(G),[_,T]=(0,i.useState)(),[Z,L]=(0,i.useState)(!0),[z,D]=(0,i.useState)(!1),[A,R]=(0,i.useState)(!1),K=(0,i.useRef)(null),U=(0,i.useRef)(null),J=(0,i.useRef)(null),$=(0,i.useCallback)(async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(d){var n,o,i,c,x,h,f,g;let v,b;if(t){let r=[...d.messages];for(let e=0;e<t;e++)r.pop();v={...d,messages:[...r,e]}}else v={...d,messages:[...d.messages,e]};C({field:"selectedConversation",value:v}),C({field:"loading",value:!0}),C({field:"messageIsStreaming",value:!0});let y={conversationId:v.id,model:v.model,messages:v.messages,key:m,prompt:v.prompt},_=O(r);b=r?JSON.stringify({...y,googleAPIKey:null===(n=null===(o=p.find(e=>"google-search"===e.pluginId))||void 0===o?void 0:o.requiredKeys.find(e=>"GOOGLE_API_KEY"===e.key))||void 0===n?void 0:n.value,googleCSEId:null===(i=null===(c=p.find(e=>"google-search"===e.pluginId))||void 0===c?void 0:c.requiredKeys.find(e=>"GOOGLE_CSE_ID"===e.key))||void 0===i?void 0:i.value}):JSON.stringify(y);let S=new AbortController,I=await fetch(_,{method:"POST",headers:{"x-auth-code":null!==(x=null==j?void 0:j.authCode)&&void 0!==x?x:"","Content-Type":"application/json"},signal:S.signal,body:b});if(200!==I.status){C({field:"loading",value:!1}),C({field:"messageIsStreaming",value:!1}),402===I.status?E.ZP.error(a("user balance not enough")):401===I.status&&E.ZP.error(a("User does not exist, please fill in authcode or go to charge to obtain an account"));return}if(!I.ok){C({field:"loading",value:!1}),C({field:"messageIsStreaming",value:!1}),E.ZP.error(null!==(g=a(I.statusText||(null===(h=I.body)||void 0===h?void 0:h.message)))&&void 0!==g?g:I.statusText||(null===(f=I.body)||void 0===f?void 0:f.message));return}let P=I.body;if(!P){C({field:"loading",value:!1}),C({field:"messageIsStreaming",value:!1});return}if(r){let{answer:e}=await I.json(),t=[...v.messages,{role:"assistant",content:e}];v={...v,messages:t},C({field:"selectedConversation",value:w}),k(v);let r=u.map(e=>e.id===d.id?v:e);0===r.length&&r.push(v),C({field:"conversations",value:r}),N(r),C({field:"loading",value:!1}),C({field:"messageIsStreaming",value:!1})}else{if(1===v.messages.length){let{content:t}=e,r=t.length>30?t.substring(0,30)+"...":t;v={...v,name:r}}C({field:"loading",value:!1});let t=P.getReader(),r=new TextDecoder,a=!1,n=!0,o="";for(;!a;){if(!0===l.current){S.abort(),a=!0;break}let{value:e,done:s}=await t.read();a=s;let i=r.decode(e);if(o+=i,n){n=!1;let e=[...v.messages,{role:"assistant",content:i}];C({field:"selectedConversation",value:v={...v,messages:e}})}else{let e=v.messages.map((e,t)=>t===v.messages.length-1?{...e,content:o}:e);C({field:"selectedConversation",value:v={...v,messages:e}})}}let i=setTimeout(()=>{clearTimeout(i),s(null==j?void 0:j.authCode)},500);k(v);let c=u.map(e=>e.id===d.id?v:e);0===c.length&&c.push(v),C({field:"conversations",value:c}),N(c),C({field:"messageIsStreaming",value:!1})}}},[m,j,u,p,d,l]);(0,i.useCallback)(()=>{if(Z){var e,t;null===(e=K.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}),null===(t=J.current)||void 0===t||t.focus()}},[Z]);let H=()=>{if(U.current){let{scrollTop:e,scrollHeight:t,clientHeight:r}=U.current;e+r<t-30?(L(!1),R(!0)):(L(!0),R(!1))}},W=()=>{var e;null===(e=U.current)||void 0===e||e.scrollTo({top:U.current.scrollHeight,behavior:"smooth"})},B=()=>{D(!z)},q=()=>{confirm(a("Are you sure you want to clear all messages?"))&&d&&y(d,{key:"messages",value:[]})},Y=()=>{if(Z){var e;null===(e=K.current)||void 0===e||e.scrollIntoView(!0)}},V=function(){for(var e=arguments.length,l=Array(e),a=0;a<e;a++)l[a]=arguments[a];r?(clearTimeout(t),t=setTimeout(()=>{Date.now()-r>=250&&(Y(...l),r=Date.now())},250-(Date.now()-r))):(Y(...l),r=Date.now())};return(0,i.useEffect)(()=>{V(),d&&T(d.messages[d.messages.length-2])},[d,V]),(0,i.useEffect)(()=>{let e=new IntersectionObserver(e=>{let[t]=e;if(L(t.isIntersecting),t.isIntersecting){var r;null===(r=J.current)||void 0===r||r.focus()}},{root:null,threshold:.5}),t=K.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[K]),(0,o.jsxs)("div",{className:"relative flex-1 overflow-hidden bg-white dark:bg-[#343541] ".concat(n?"pt-0":"pt-10"),children:[m||h?g?(0,o.jsx)(ej,{error:g}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"max-h-full overflow-x-hidden",ref:U,onScroll:H,children:(null==d?void 0:d.messages.length)===0?(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"mx-auto flex w-[350px] flex-col space-y-10 pt-12 sm:w-[600px]",children:[(0,o.jsx)("div",{className:"text-center text-3xl font-semibold text-gray-800 dark:text-gray-100",children:0===x.length?(0,o.jsx)("div",{children:(0,o.jsx)(F,{size:"16px",className:"mx-auto"})}):"Liaobots UI"}),(0,o.jsx)(M,{}),x.length>0&&(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)("div",{className:"flex h-full flex-col space-y-4 rounded-lg border border-neutral-200 p-4 dark:border-neutral-600",children:[(0,o.jsx)(ew,{}),(0,o.jsx)(ek,{conversation:d,prompts:b,onChangePrompt:e=>y(d,{key:"prompt",value:e})})]})})]})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex justify-center border border-b-neutral-300 bg-neutral-100 py-2 text-sm text-neutral-500 dark:border-none dark:bg-[#444654] dark:text-neutral-200",children:[a("Model"),": ",null==d?void 0:d.model.name,(0,o.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:B,children:(0,o.jsx)(S.Z,{size:18})}),(0,o.jsx)("button",{className:"ml-2 cursor-pointer hover:opacity-50",onClick:q,children:(0,o.jsx)(I.Z,{size:18})})]}),z&&(0,o.jsx)("div",{className:"flex flex-col space-y-10 md:mx-auto md:max-w-xl md:gap-6 md:py-3 md:pt-6 lg:max-w-2xl lg:px-0 xl:max-w-3xl",children:(0,o.jsx)("div",{className:"flex h-full flex-col space-y-4 border-b border-neutral-200 p-4 dark:border-neutral-600 md:rounded-lg md:border",children:(0,o.jsx)(ew,{})})}),null==d?void 0:d.messages.map((e,t)=>(0,o.jsx)(ev,{message:e,messageIndex:t},t)),v&&(0,o.jsx)(et,{}),(0,o.jsx)("div",{className:"h-[162px] bg-white dark:bg-[#343541]",ref:K})]})}),(0,o.jsx)(X,{stopConversationRef:l,textareaRef:J,onSend:(e,t)=>{T(e),$(e,0,t)},onRegenerate:()=>{_&&$(_,2,null)}})]}):(0,o.jsxs)("div",{className:"mx-auto flex h-full w-[300px] flex-col justify-center space-y-6 sm:w-[600px]",children:[(0,o.jsx)("div",{className:"text-center text-4xl font-bold text-black dark:text-white",children:"Welcome to Liaobots UI"}),(0,o.jsxs)("div",{className:"text-center text-lg text-black dark:text-white",children:[(0,o.jsx)("div",{className:"mb-8",children:"Liaobots UI is an open source clone of OpenAI's ChatGPT UI."}),(0,o.jsx)("div",{className:"mb-2 font-bold",children:"Important: Liaobots UI is 100% unaffiliated with OpenAI."})]}),(0,o.jsxs)("div",{className:"text-center text-gray-500 dark:text-gray-400",children:[(0,o.jsx)("div",{className:"mb-2",children:"Liaobots UI allows you to plug in your API key to use this UI with their API."}),(0,o.jsxs)("div",{className:"mb-2",children:["It is ",(0,o.jsx)("span",{className:"italic",children:"only"})," used to communicate with their API."]}),(0,o.jsx)("div",{className:"mb-2",children:a("Please set your OpenAI API key in the bottom left of the sidebar.")}),(0,o.jsxs)("div",{children:[a("If you don't have an OpenAI API key, you can get one here: "),(0,o.jsx)("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noreferrer",className:"text-blue-500 hover:underline",children:"openai.com"})]})]})]}),A&&(0,o.jsx)("div",{className:"absolute bottom-0 right-0 mb-4 mr-4 pb-20",children:(0,o.jsx)("button",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-neutral-300 text-gray-800 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-neutral-200",onClick:W,children:(0,o.jsx)(P.Z,{size:18})})})]})});eC.displayName="Chat";let e_=()=>{let e=localStorage.getItem("conversationHistory"),t=localStorage.getItem("folders"),r=localStorage.getItem("prompts");e&&(e=JSON.parse(e)),t&&(t=JSON.parse(t)),r&&(r=JSON.parse(r));let l={version:4,history:e||[],folders:t||[],prompts:r||[]},a=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),s=URL.createObjectURL(a),n=document.createElement("a");n.download="chatbot_ui_history_".concat(function(){let e=new Date,t=e.getMonth()+1,r=e.getDate();return"".concat(t,"-").concat(r)}(),".json"),n.href=s,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},eS=e=>{let t=function(e){if(Array.isArray(e))return{version:4,history:y(e),folders:[],prompts:[]};if(!("version"in e)&&"folders"in e&&"history"in e)return{version:4,history:y(e.history||[]),folders:(e.folders||[]).map(e=>({id:e.id.toString(),name:e.name,type:"chat"})),prompts:[]};if(3===e.version)return{...e,version:4,prompts:[]};if(4===e.version)return e;throw Error("Unsupported data format")}(e),{history:r,folders:l,prompts:a}=t;return localStorage.setItem("conversationHistory",JSON.stringify(r)),localStorage.setItem("selectedConversation",JSON.stringify(r[r.length-1])),localStorage.setItem("folders",JSON.stringify(l)),localStorage.setItem("prompts",JSON.stringify(a)),t};var eI=r(87664),eP=r(62577),eE=r(97283),eT=r(30471);let eZ=e=>{let{handleClick:t,children:r}=e;return(0,o.jsx)("button",{className:"min-w-[20px] p-1 text-neutral-400 hover:text-neutral-100",onClick:t,children:r})},eO=e=>{let{currentFolder:t,searchTerm:r,handleDrop:l,folderComponent:a}=e,{handleDeleteFolder:s,handleUpdateFolder:n}=(0,i.useContext)(G),[d,c]=(0,i.useState)(!1),[u,x]=(0,i.useState)(!1),[m,p]=(0,i.useState)(""),[h,f]=(0,i.useState)(!1),g=e=>{"Enter"===e.key&&(e.preventDefault(),v())},v=()=>{n(t.id,m),p(""),x(!1)},b=e=>{e.dataTransfer&&(f(!0),l(e,t),e.target.style.background="none")},j=e=>{e.preventDefault()},y=e=>{e.target.style.background="#343541"},w=e=>{e.target.style.background="none"};return(0,i.useEffect)(()=>{u?c(!1):d&&x(!1)},[u,d]),(0,i.useEffect)(()=>{r?f(!0):f(!1)},[r]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"relative flex items-center",children:[u?(0,o.jsxs)("div",{className:"flex w-full items-center gap-3 bg-[#343541]/90 p-3",children:[h?(0,o.jsx)(eI.Z,{size:18}):(0,o.jsx)(eP.Z,{size:18}),(0,o.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:m,onChange:e=>p(e.target.value),onKeyDown:g,autoFocus:!0})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",onClick:()=>f(!h),onDrop:e=>b(e),onDragOver:j,onDragEnter:y,onDragLeave:w,children:[h?(0,o.jsx)(eI.Z,{size:18}):(0,o.jsx)(eP.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3",children:t.name})]}),(d||u)&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(eZ,{handleClick:e=>{e.stopPropagation(),d?s(t.id):u&&v(),c(!1),x(!1)},children:(0,o.jsx)(es.Z,{size:18})}),(0,o.jsx)(eZ,{handleClick:e=>{e.stopPropagation(),c(!1),x(!1)},children:(0,o.jsx)(eE.Z,{size:18})})]}),!d&&!u&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(eZ,{handleClick:e=>{e.stopPropagation(),x(!0),p(t.name)},children:(0,o.jsx)(eT.Z,{size:18})}),(0,o.jsx)(eZ,{handleClick:e=>{e.stopPropagation(),c(!0)},children:(0,o.jsx)(ea.Z,{size:18})})]})]}),h?a:null]})};var eG=r(47447);let eL=(0,i.createContext)(void 0);var ez=r(54021);let eD=e=>{let{conversation:t}=e,{state:{userInfo:r,models:l,defaultModelId:a,selectedConversation:s,messageIsStreaming:n},handleSelectConversation:d,handleUpdateConversation:c}=(0,i.useContext)(G),{handleDeleteConversation:u}=(0,i.useContext)(eL),{defaultModel:x,isForbiddenGPT4:m,warnGPT4:p}=ey({userInfo:r,models:l,defaultModelId:a}),[h,f]=(0,i.useState)(!1),[g,v]=(0,i.useState)(!1),[b,j]=(0,i.useState)(""),y=e=>{"Enter"===e.key&&(e.preventDefault(),s&&k(s))},w=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("conversation",JSON.stringify(t))},k=e=>{b.trim().length>0&&(c(e,{key:"name",value:b}),j(""),v(!1))},N=e=>{e.stopPropagation(),h?u(t):g&&k(t),f(!1),v(!1)},C=e=>{e.stopPropagation(),f(!1),v(!1)},_=e=>{e.stopPropagation(),v(!0),s&&j(s.name)},S=e=>{e.stopPropagation(),f(!0)};return(0,i.useEffect)(()=>{g?f(!1):h&&v(!1)},[g,h]),(0,ez.Z)(()=>{(null==s?void 0:s.id)===t.id&&m(t)&&(p(),c(t,{key:"model",value:x}))},[null==r?void 0:r.amount]),(0,o.jsxs)("div",{className:"relative flex items-center",children:[g&&(null==s?void 0:s.id)===t.id?(0,o.jsxs)("div",{className:"flex w-full items-center gap-3 rounded-lg bg-[#343541]/90 p-3",children:[(0,o.jsx)(eG.Z,{size:18}),(0,o.jsx)("input",{className:"mr-12 flex-1 overflow-hidden overflow-ellipsis border-neutral-400 bg-transparent text-left text-[12.5px] leading-3 text-white outline-none focus:border-neutral-100",type:"text",value:b,onChange:e=>j(e.target.value),onKeyDown:y,autoFocus:!0})]}):(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90 ".concat(n?"disabled:cursor-not-allowed":""," ").concat((null==s?void 0:s.id)===t.id?"bg-[#343541]/90":""),onClick:()=>d(t),disabled:n,draggable:"true",onDragStart:e=>w(e,t),children:[(0,o.jsx)(eG.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all text-left text-[12.5px] leading-3 ".concat((null==s?void 0:s.id)===t.id?"pr-12":"pr-1"),children:t.name})]}),(h||g)&&(null==s?void 0:s.id)===t.id&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(eZ,{handleClick:N,children:(0,o.jsx)(es.Z,{size:18})}),(0,o.jsx)(eZ,{handleClick:C,children:(0,o.jsx)(eE.Z,{size:18})})]}),(null==s?void 0:s.id)===t.id&&!h&&!g&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(eZ,{handleClick:_,children:(0,o.jsx)(eT.Z,{size:18})}),(0,o.jsx)(eZ,{handleClick:S,children:(0,o.jsx)(ea.Z,{size:18})})]})]})},eA=e=>{let{searchTerm:t}=e,{state:{folders:r,conversations:l},handleUpdateConversation:a}=(0,i.useContext)(G),s=(e,t)=>{if(e.dataTransfer){let r=JSON.parse(e.dataTransfer.getData("conversation"));a(r,{key:"folderId",value:t.id})}},n=e=>l&&l.filter(e=>e.folderId).map((t,r)=>{if(t.folderId===e.id)return(0,o.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,o.jsx)(eD,{conversation:t})},r)});return(0,o.jsx)("div",{className:"flex w-full flex-col pt-2",children:r.filter(e=>"chat"===e.type).map((e,r)=>(0,o.jsx)(eO,{searchTerm:t,currentFolder:e,handleDrop:s,folderComponent:n(e)},r))})};var eR=r(11039),eK=r(39636),eU=r(37176);let eM=e=>{let{text:t,icon:r,className:l="",children:a,onClick:s}=e;return(0,o.jsxs)("button",{disabled:!s,className:(0,V.Z)(s?"hover:bg-gray-500/10 cursor-pointer ":"","flex w-full select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors",l),onClick:s,children:[(0,o.jsx)("div",{children:r}),t&&(0,o.jsx)("span",{className:"grow text-left",children:t}),a]})};var eF=r(35336);let eJ=e=>{let{text:t,icon:r,onClick:l}=e;return(0,o.jsxs)("button",{className:"flex w-full cursor-pointer select-none items-center gap-3 rounded-md py-3 px-3 text-[14px] leading-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:l,children:[(0,o.jsx)("div",{children:r}),(0,o.jsx)("span",{children:t})]})},e$=()=>{var e;let{t}=(0,c.$G)("sidebar"),{state:{userInfo:r},dispatch:l}=(0,i.useContext)(G),[a,s]=(0,i.useState)(!1),[n,d]=(0,i.useState)(null!==(e=null==r?void 0:r.authCode)&&void 0!==e?e:""),u=(0,i.useRef)(null),x=e=>{"Enter"===e.key&&(e.preventDefault(),p(n))},m=e=>{l({field:"userInfo",value:{...r,authCode:e}})},p=e=>{m(e.trim()),s(!1)};return(0,i.useEffect)(()=>{if(a){var e;null===(e=u.current)||void 0===e||e.focus()}},[a]),(0,i.useEffect)(()=>{(null==r?void 0:r.authCode)&&d(null==r?void 0:r.authCode)},[null==r?void 0:r.authCode]),a?(0,o.jsxs)("div",{className:"duration:200 flex w-full cursor-pointer items-center rounded-md py-3 px-3 transition-colors hover:bg-gray-500/10",children:[(0,o.jsx)(eF.Z,{size:18}),(0,o.jsx)("input",{ref:u,className:"ml-2 h-[20px] flex-1 overflow-hidden overflow-ellipsis border-b border-neutral-400 bg-transparent pr-1 text-[12.5px] leading-3 text-left text-white outline-none focus:border-neutral-100",value:n,onChange:e=>d(e.target.value),onKeyDown:x,placeholder:"auth code"}),(0,o.jsxs)("div",{className:"flex w-[40px]",children:[(0,o.jsx)(es.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),p(n)}}),(0,o.jsx)(eE.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{var t;e.stopPropagation(),s(!1),d(null!==(t=null==r?void 0:r.authCode)&&void 0!==t?t:"")}})]})]}):(0,o.jsx)(eJ,{text:t("Auth code"),icon:(0,o.jsx)(eF.Z,{size:18}),onClick:()=>s(!0)})};var eH=r(35977),eW=r.n(eH);let eB=[{value:1,gift:0,gpt_3_5_about:"25,000 ~ 37,500",gpt_4_0_about:"1,250 ~ 1,900",msgColor:"rgb(240, 77, 77)"},{value:10,gift:10,gpt_3_5_about:"275,000 ~ 412,500",gpt_4_0_about:"13,750 ~ 20,600",msgColor:"rgb(246, 168, 35)"},{value:20,gift:20,gpt_3_5_about:"600,000 ~ 900,000",gpt_4_0_about:"30,000 ~ 45,000",msgColor:"rgb(69, 159, 246)"},{value:50,gift:30,gpt_3_5_about:"1,625,000 ~ 2,435,000",gpt_4_0_about:"81,200 ~ 122,000",msgColor:"rgb(74, 224, 129)"}],eq=[{label:"GPT-3.5",value:a.GPT_3_5},{label:"GPT-4",value:a.GPT_4}],eY=e=>{let{onClose:t,setAuthCode:r}=e,l=h(),{t:s}=(0,c.$G)("promptbar"),{state:{userInfo:n}}=(0,i.useContext)(G),[d,u]=(0,i.useState)(1),[x,m]=(0,i.useState)(!1),[p,f]=(0,i.useState)(),[g,v]=(0,i.useState)(a.GPT_3_5),b=(0,i.useRef)(null),j=(0,i.useRef)(null),y=(0,i.useRef)(null),w=(0,i.useCallback)((e,t)=>{var r;return l.post("/api/charge",{body:{authcode:null!==(r=null==n?void 0:n.authCode)&&void 0!==r?r:"",amount:e,return_url:window.location.href},headers:{"Content-Type":"application/json"},signal:t})},[l]),k=async()=>{m(!0);try{let e=await w(eB[d].value);f(e),e.authCode&&(r(e.authCode),setTimeout(()=>{var e;m(!1),null===(e=y.current)||void 0===e||e.click()},50))}catch(e){m(!1)}},N=e=>{u(e)};return(0,i.useEffect)(()=>{let e=e=>{b.current&&!b.current.contains(e.target)&&window.addEventListener("mouseup",r)},r=e=>{window.removeEventListener("mouseup",r),t()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[t]),(0,i.useEffect)(()=>{var e;null===(e=j.current)||void 0===e||e.focus()},[]),(0,o.jsx)("div",{className:(0,V.Z)(eW().chargeModal,"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-100"),children:(0,o.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,o.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,o.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,o.jsxs)("div",{ref:b,className:(0,V.Z)(eW().modal,"dark:border-netural-400 inline-block transform overflow-hidden rounded-lg border border-gray-300 text-left align-bottom shadow-xl transition-all sm:my-8 sm:max-h-[600px] sm:w-full sm:align-middle"),role:"dialog",children:[(0,o.jsxs)("div",{className:eW().header,children:[s("Charge"),(0,o.jsx)("button",{className:eW().close,onClick:t,children:(0,o.jsx)(eE.Z,{size:14})})]}),(0,o.jsxs)("div",{className:eW().body,children:[(0,o.jsxs)("div",{className:eW().title,children:[(0,o.jsx)("p",{children:s("We follow the pricing of OpenAI API and adjust it based on exchange rates and actual costs")}),(0,o.jsxs)("div",{className:eW().price_p,children:[(0,o.jsxs)("div",{children:[s("Current price"),":"]}),(0,o.jsx)("div",{className:eW().radio,children:eq.map(e=>(0,o.jsx)("label",{className:(0,V.Z)(eW().radioItem,g===e.value&&eW().selected),onClick:()=>v(e.value),children:e.label},e.value))})]}),(0,o.jsx)("p",{className:eW().price,children:(0,o.jsx)("div",{className:eW().priceDesc,children:g===a.GPT_3_5?(0,o.jsx)("p",{children:s("GPT-3.5-price",{price:2})}):(0,o.jsx)("p",{children:s("GPT-4.0-price",{request:40,response:80})})})})]}),(0,o.jsxs)("div",{className:eW().list,children:[eB.map((e,t)=>(0,o.jsx)("div",{className:(0,V.Z)(eW().item,d===t&&eW().itemSelected),onClick:()=>N(t),children:(0,o.jsxs)("label",{className:eW().radioItem,children:[(0,o.jsxs)("div",{className:eW().radioText,children:["\xa5 ",e.value,(0,o.jsx)("span",{className:eW().giftText,children:e.gift?" (".concat(s("Gift")," ").concat(e.gift," %)"):""})]}),(0,o.jsxs)("div",{className:eW().radioMsg,style:{color:e.msgColor},children:[s("Approximately")," ",e[g===a.GPT_3_5?"gpt_3_5_about":"gpt_4_0_about"]," ",s("characters")]})]})},t)),p&&(0,o.jsxs)("form",{method:"get",action:p.url,style:{display:"none"},children:[Object.entries(p.params).map(e=>{let[t,r]=e;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("label",{htmlFor:t}),(0,o.jsx)("input",{name:t,value:r})]})}),(0,o.jsx)("button",{type:"submit",ref:y,children:"提交"})]})]}),(0,o.jsxs)("div",{className:eW().footer,children:[(0,o.jsx)("p",{children:s("Points rule",{point:100})}),(0,o.jsx)("p",{children:s("Long continuous conversations will increase the cost, please be mindful of the expenses")})]})]}),(0,o.jsxs)("button",{type:"button",disabled:x||void 0===d,className:(0,V.Z)(eW().pay,"w-full shadow text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:bg-white dark:text-black dark:hover:bg-neutral-300"),onClick:k,children:[x&&(0,o.jsx)("span",{style:{marginRight:4},children:(0,o.jsx)(F,{size:"16px",className:"inline mx-auto"})}),(0,o.jsx)("i",{className:"liaobots icon-liaobotswechat-pay"})," ",s("WeChat Pay")]})]})]})})})},eV=null,eX=(0,i.forwardRef)((e,t)=>{let{value:l,option:a}=e,s=(0,i.useRef)(null);async function n(){let e=await r.e(273).then(r.bind(r,8273));(eV=new e.CountUp(s.current,l,a)).error?console.error(null==eV?void 0:eV.error):null==eV||eV.start()}let d=()=>{null==eV||eV.reset(),null==eV||eV.start()},c=e=>{null==eV||eV.update(e)};return(0,i.useEffect)(()=>(n(),()=>{eV=null}),[]),(0,i.useImperativeHandle)(t,()=>({restart:d,update:c})),(0,o.jsx)("span",{ref:s,children:"0"})}),eQ=()=>{var e;let{t}=(0,c.$G)("sidebar"),{state:{inited:r,userInfo:l,selectedConversation:a},dispatch:s}=(0,i.useContext)(G),n=(0,eU.Z)(null!==(e=null==l?void 0:l.balance)&&void 0!==e?e:0),[d,u]=(0,i.useState)(!1),x=(0,i.useRef)(),{loading:m,fetchUser:p}=eN(),h=(0,i.useCallback)(()=>(0,o.jsx)(eX,{ref:x,value:100*l.balance,option:{useEasing:!1,duration:1,decimalPlaces:0,startVal:null!=n?n:0}}),[null==l?void 0:l.balance,n]),f=e=>{s({field:"userInfo",value:{...l,authCode:e}})};return(0,ez.Z)(()=>{"string"==typeof(null==l?void 0:l.authCode)&&localStorage.setItem("authCode",null==l?void 0:l.authCode),p(null==l?void 0:l.authCode)},[null==l?void 0:l.authCode]),(0,ez.Z)(()=>{var e;null===(e=x.current)||void 0===e||e.update(100*l.balance)},[null==l?void 0:l.balance]),(0,o.jsxs)(o.Fragment,{children:[!r||m?(0,o.jsx)(eM,{icon:(0,o.jsx)(F,{size:"16px",className:"mx-auto"})}):(null==l?void 0:l.balance)!==void 0?(0,o.jsx)(eM,{text:(0,o.jsxs)(o.Fragment,{children:[t("Balance"),":","  ",(0,o.jsx)("b",{style:{fontStyle:"italic"},children:h()})]}),icon:(0,o.jsx)(eR.Z,{size:18}),onClick:async()=>p(null==l?void 0:l.authCode)}):null,(0,o.jsx)(eM,{text:t("Charge"),icon:(0,o.jsx)(eK.Z,{size:18}),onClick:()=>u(!0)}),(0,o.jsx)(e$,{}),d&&(0,o.jsx)(eY,{onClose:()=>{u(!1);let e=localStorage.getItem("authCode");e&&p(e)},setAuthCode:f})]})};var e0=r(75846),e1=r(63742),e2=r(11163),e4=r(53240);let e3=()=>{let e=(0,e2.useRouter)(),{t}=(0,c.$G)("sidebar");return(0,o.jsx)(eM,{text:t("Language"),icon:(0,o.jsx)(e4.Z,{size:18}),onClick:()=>{e.replace(e.pathname,e.pathname,{locale:"en"===e.locale?"zh":"en"})}})};var e5=r(34537),e8=r.n(e5);let e6=e=>{let{onClearConversations:t}=e,[r,l]=(0,i.useState)(!1),{t:a}=(0,c.$G)("sidebar"),s=()=>{t(),l(!1)};return r?(0,o.jsxs)("div",{className:"flex w-full cursor-pointer items-center rounded-lg py-3 px-3 hover:bg-gray-500/10",children:[(0,o.jsx)(ea.Z,{size:18}),(0,o.jsx)("div",{className:"ml-3 flex-1 text-left text-[12.5px] leading-3 text-white",children:a("Are you sure?")}),(0,o.jsxs)("div",{className:"flex w-[40px]",children:[(0,o.jsx)(es.Z,{className:"ml-auto mr-1 min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),s()}}),(0,o.jsx)(eE.Z,{className:"ml-auto min-w-[20px] text-neutral-400 hover:text-neutral-100",size:18,onClick:e=>{e.stopPropagation(),l(!1)}})]})]}):(0,o.jsx)(eJ,{text:a("Clear conversations"),icon:(0,o.jsx)(ea.Z,{size:18}),onClick:()=>l(!0)})};var e7=r(52216);let e9=e=>{let{onImport:t}=e,{t:r}=(0,c.$G)("sidebar");return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("input",{id:"import-file",className:"sr-only",tabIndex:-1,type:"file",accept:".json",onChange:e=>{var r;if(!(null===(r=e.target.files)||void 0===r?void 0:r.length))return;let l=e.target.files[0],a=new FileReader;a.onload=e=>{var r;t(JSON.parse(null===(r=e.target)||void 0===r?void 0:r.result))},a.readAsText(l)}}),(0,o.jsx)(eJ,{text:r("Import data"),icon:(0,o.jsx)(e7.Z,{size:18}),onClick:()=>{let e=document.querySelector("#import-file");e&&e.click()}})]})},te=()=>{(0,e2.useRouter)();let{t:e}=(0,c.$G)("sidebar"),{state:{lightMode:t,conversations:r},dispatch:l}=(0,i.useContext)(G),{handleExportData:a,handleClearConversations:s,handleImportConversations:n}=(0,i.useContext)(eL),d=(0,i.useRef)(null),[u,x]=(0,i.useState)(!1),m=e=>{d.current&&!d.current.contains(e.target)&&x(!1)};return(0,e1.Z)(()=>(window.addEventListener("mouseup",m),()=>{window.removeEventListener("mouseup",m)})),(0,o.jsxs)("div",{className:(0,V.Z)(e8().relative,"flex w-full"),children:[(0,o.jsx)(eM,{text:e("Settings"),icon:(0,o.jsx)(S.Z,{size:18}),onClick:()=>x(!0),children:(0,o.jsx)("span",{children:(0,o.jsxs)("svg",{stroke:"currentColor",fill:"none",strokeWidth:"2",viewBox:"0 0 24 24",strokeLinecap:"round",strokeLinejoin:"round",className:"h-4 w-4 flex-shrink-0 text-gray-500",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"1"}),(0,o.jsx)("circle",{cx:"19",cy:"12",r:"1"}),(0,o.jsx)("circle",{cx:"5",cy:"12",r:"1"})]})})}),u&&(0,o.jsx)("div",{ref:d,className:(0,V.Z)(e8().modal,"absolute left-0 bottom-full z-20 mb-2 w-full translate-y-0 overflow-hidden rounded-md bg-[#050509] py-1.5 opacity-100 outline-none"),role:"dialog",children:(0,o.jsxs)("nav",{role:"none",children:[(0,o.jsx)(e9,{onImport:n}),(0,o.jsx)(eJ,{text:e("Export data"),icon:(0,o.jsx)(e0.Z,{size:18}),onClick:()=>a()}),(0,o.jsx)("div",{className:"my-1.5 h-px bg-white/20",role:"none"}),r.length>0?(0,o.jsx)(e6,{onClearConversations:s}):null,(0,o.jsx)(e3,{})]})})]})},tt=()=>{let{t:e}=(0,c.$G)("sidebar"),{state:{apiKey:t,lightMode:r,serverSideApiKeyIsSet:l,serverSidePluginKeysSet:a,conversations:s},dispatch:n}=(0,i.useContext)(G),{handleClearConversations:d,handleImportConversations:u,handleExportData:x,handleApiKeyChange:m}=(0,i.useContext)(eL);return(0,o.jsxs)("div",{className:"flex flex-col items-center space-y-1 border-t border-white/20 pt-1 text-sm",children:[(0,o.jsx)(eQ,{}),(0,o.jsx)(te,{})]})},tr=e=>{let{conversations:t}=e;return(0,o.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.filter(e=>!e.folderId).slice().reverse().map((e,t)=>(0,o.jsx)(eD,{conversation:e},t))})};var tl=r(1177),ta=r(16745),ts=r(92005),tn=r(67421),to=r(98963),ti=r(89014),td=r(68225),tc=r.n(td);let tu=e=>{let{onClick:t,side:r}=e,{state:{closeSite:l}}=(0,i.useContext)(G);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("button",{className:"fixed ".concat(l?"top-2.5":tc()["top-12_5"]," ").concat("right"===r?"right-[270px]":"left-[270px]"," z-50 h-7 w-7 hover:text-gray-400 dark:text-white dark:hover:text-gray-300 ").concat(l?"sm:top-0.5":"sm:top-10"," sm:").concat("right"===r?"right-[270px]":"left-[270px]"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===r?(0,o.jsx)(to.Z,{}):(0,o.jsx)(ti.Z,{})}),(0,o.jsx)("div",{onClick:t,className:"absolute top-0 left-0 z-10 h-full w-full bg-black opacity-70 sm:hidden"})]})},tx=e=>{let{onClick:t,side:r}=e,{state:{closeSite:l}}=(0,i.useContext)(G);return(0,o.jsx)("button",{className:"fixed ".concat(l?"top-2.5":tc()["top-12_5"]," ").concat("right"===r?"right-2":"left-2"," z-50 h-7 w-7 text-white hover:text-gray-400 dark:text-white dark:hover:text-gray-300 ").concat(l?"sm:top-0.5":"sm:top-10"," sm:").concat("right"===r?"right-2":"left-2"," sm:h-8 sm:w-8 sm:text-neutral-700"),onClick:t,children:"right"===r?(0,o.jsx)(ti.Z,{}):(0,o.jsx)(to.Z,{})})},tm=e=>{let{placeholder:t,searchTerm:r,onSearch:l}=e,{t:a}=(0,c.$G)("sidebar"),s=e=>{l(e.target.value)},n=()=>{l("")};return(0,o.jsxs)("div",{className:"relative flex items-center",children:[(0,o.jsx)("input",{className:"w-full flex-1 rounded-md border border-neutral-600 bg-[#202123] px-4 py-3 pr-10 text-[14px] leading-3 text-white",type:"text",placeholder:a(t)||"",value:r,onChange:s}),r&&(0,o.jsx)(eE.Z,{className:"absolute right-4 cursor-pointer text-neutral-300 hover:text-neutral-400",size:18,onClick:n})]})},tp=e=>{let{isOpen:t,addItemButtonTitle:r,side:l,items:a,itemComponent:s,folderComponent:n,footerComponent:d,searchTerm:c,handleSearchTerm:u,toggleOpen:x,handleCreateItem:m,handleCreateFolder:p,handleDrop:h}=e,{state:{closeSite:f}}=(0,i.useContext)(G),{t:g}=(0,tn.$G)("promptbar"),v=e=>{e.preventDefault()},b=e=>{e.target.style.background="#343541"},j=e=>{e.target.style.background="none"};return t?(0,o.jsxs)("div",{children:[(0,o.jsxs)("div",{className:"fixed top-0 ".concat(f?"pt-0":"pt-12"," ").concat(l,"-0 z-40 flex h-full w-[260px] flex-none flex-col space-y-2 bg-[#202123] p-2 text-[14px] transition-all sm:relative sm:top-0"),children:[(0,o.jsxs)("div",{className:"flex items-center",children:[(0,o.jsxs)("button",{className:"text-sidebar flex w-[190px] flex-shrink-0 cursor-pointer select-none items-center gap-3 rounded-md border border-white/20 p-3 text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:()=>{m(),u("")},children:[(0,o.jsx)(tl.Z,{size:16}),r]}),(0,o.jsx)("button",{className:"ml-2 flex flex-shrink-0 cursor-pointer items-center gap-3 rounded-md border border-white/20 p-3 text-sm text-white transition-colors duration-200 hover:bg-gray-500/10",onClick:p,children:(0,o.jsx)(ta.Z,{size:16})})]}),(null==a?void 0:a.length)>0&&(0,o.jsx)(tm,{placeholder:g("Search prompts...")||"",searchTerm:c,onSearch:u}),(0,o.jsxs)("div",{className:"flex-grow overflow-auto",children:[(null==a?void 0:a.length)>0&&(0,o.jsx)("div",{className:"flex border-b border-white/20 pb-2",children:n}),(null==a?void 0:a.length)>0?(0,o.jsx)("div",{className:"pt-2",onDrop:h,onDragOver:v,onDragEnter:b,onDragLeave:j,children:s}):(0,o.jsxs)("div",{className:"mt-8 select-none text-center text-white opacity-50",children:[(0,o.jsx)(ts.Z,{className:"mx-auto mb-3"}),(0,o.jsx)("span",{className:"text-[14px] leading-normal",children:g("No prompts.")})]})]}),d]}),(0,o.jsx)(tu,{onClick:x,side:l})]}):(0,o.jsx)(tx,{onClick:x,side:l})},th={searchTerm:"",filteredConversations:[]};var tf=r(57632);let tg=()=>{let{t:e}=(0,c.$G)("sidebar"),t=m({initialState:th}),{state:{conversations:r,showChatbar:l,defaultModelId:a,folders:s,pluginKeys:n},dispatch:d,handleCreateFolder:u,handleNewConversation:x,handleUpdateConversation:p}=(0,i.useContext)(G),{state:{searchTerm:h,filteredConversations:f},dispatch:v}=t,j=(0,i.useCallback)(e=>{d({field:"apiKey",value:e}),localStorage.setItem("apiKey",e)},[d]),y=e=>{if(n.some(t=>t.pluginId===e.pluginId)){let t=n.map(t=>t.pluginId===e.pluginId?e:t);d({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))}else d({field:"pluginKeys",value:[...n,e]}),localStorage.setItem("pluginKeys",JSON.stringify([...n,e]))},w=e=>{let t=n.filter(t=>t.pluginId!==e.pluginId);if(0===t.length){d({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys");return}d({field:"pluginKeys",value:t}),localStorage.setItem("pluginKeys",JSON.stringify(t))},_=()=>{e_()},S=e=>{let{history:t,folders:r,prompts:l}=eS(e);d({field:"conversations",value:t}),d({field:"selectedConversation",value:t[t.length-1]}),d({field:"folders",value:r}),d({field:"prompts",value:l})},I=()=>{a&&d({field:"selectedConversation",value:{id:(0,tf.Z)(),name:"New conversation",messages:[],model:g[a],prompt:b,folderId:null}}),d({field:"conversations",value:[]}),localStorage.removeItem("conversationHistory"),localStorage.removeItem("selectedConversation");let e=s.filter(e=>"chat"!==e.type);d({field:"folders",value:e}),C(e)},P=e=>{let t=r.filter(t=>t.id!==e.id);d({field:"conversations",value:t}),v({field:"searchTerm",value:""}),N(t),t.length>0?(d({field:"selectedConversation",value:t[t.length-1]}),k(t[t.length-1])):(a&&d({field:"selectedConversation",value:{id:(0,tf.Z)(),name:"New conversation",messages:[],model:g[a],prompt:b,folderId:null}}),localStorage.removeItem("selectedConversation"))},E=()=>{d({field:"showChatbar",value:!l}),localStorage.setItem("showChatbar",JSON.stringify(!l))},T=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("conversation"));p(t,{key:"folderId",value:0}),v({field:"searchTerm",value:""}),e.target.style.background="none"}};return(0,i.useEffect)(()=>{h?v({field:"filteredConversations",value:r.filter(e=>{let t=e.name.toLocaleLowerCase()+" "+e.messages.map(e=>e.content).join(" ");return t.toLowerCase().includes(h.toLowerCase())})}):v({field:"filteredConversations",value:r})},[h,r]),(0,o.jsx)(eL.Provider,{value:{...t,handleDeleteConversation:P,handleClearConversations:I,handleImportConversations:S,handleExportData:_,handlePluginKeyChange:y,handleClearPluginKey:w,handleApiKeyChange:j},children:(0,o.jsx)(tp,{side:"left",isOpen:l,addItemButtonTitle:e("New chat"),itemComponent:(0,o.jsx)(tr,{conversations:f}),folderComponent:(0,o.jsx)(eA,{searchTerm:h}),items:f,searchTerm:h,handleSearchTerm:e=>v({field:"searchTerm",value:e}),toggleOpen:E,handleCreateItem:x,handleCreateFolder:()=>u(e("New folder"),"chat"),handleDrop:T,footerComponent:(0,o.jsx)(tt,{})})})},tv=e=>{let{selectedConversation:t,onNewConversation:r}=e;return(0,o.jsxs)("nav",{className:"flex w-full justify-between bg-[#202123] py-3 px-4",children:[(0,o.jsx)("div",{className:"mr-4"}),(0,o.jsx)("div",{className:"max-w-[240px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.name}),(0,o.jsx)(tl.Z,{className:"cursor-pointer hover:text-neutral-400 mr-8",onClick:r})]})};var tb=r(12691);let tj=(0,i.createContext)(void 0),ty=e=>{let{prompt:t,onClose:r,onUpdatePrompt:l}=e,{t:a}=(0,c.$G)("promptbar"),[s,n]=(0,i.useState)(t.name),[d,u]=(0,i.useState)(t.description),[x,m]=(0,i.useState)(t.content),p=(0,i.useRef)(null),h=(0,i.useRef)(null),f=e=>{"Enter"!==e.key||e.shiftKey||(l({...t,name:s,description:d,content:x.trim()}),r())};return(0,i.useEffect)(()=>{let e=e=>{p.current&&!p.current.contains(e.target)&&window.addEventListener("mouseup",t)},t=e=>{window.removeEventListener("mouseup",t),r()};return window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}},[r]),(0,i.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.focus()},[]),(0,o.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",onKeyDown:f,children:(0,o.jsx)("div",{className:"fixed inset-0 z-10 overflow-hidden",children:(0,o.jsxs)("div",{className:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,o.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,o.jsxs)("div",{ref:p,className:"dark:border-netural-400 inline-block max-h-[400px] transform overflow-y-auto rounded-lg border border-gray-300 bg-white px-4 pt-5 pb-4 text-left align-bottom shadow-xl transition-all dark:bg-[#202123] sm:my-8 sm:max-h-[600px] sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",role:"dialog",children:[(0,o.jsx)("div",{className:"text-sm font-bold text-black dark:text-neutral-200",children:a("Name")}),(0,o.jsx)("input",{ref:h,className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",placeholder:a("A name for your prompt.")||"",value:s,onChange:e=>n(e.target.value)}),(0,o.jsx)("div",{className:"mt-6 text-sm font-bold text-black dark:text-neutral-200",children:a("Description")}),(0,o.jsx)("textarea",{className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:a("A description for your prompt.")||"",value:d,onChange:e=>u(e.target.value),rows:3}),(0,o.jsx)("div",{className:"mt-6 text-sm font-bold text-black dark:text-neutral-200",children:a("Prompt")}),(0,o.jsx)("textarea",{className:"mt-2 w-full rounded-lg border border-neutral-500 px-4 py-2 text-neutral-900 shadow focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-[#40414F] dark:text-neutral-100",style:{resize:"none"},placeholder:a("Prompt content. Use {{}} to denote a variable. Ex: {{name}} is a {{adjective}} {{noun}}")||"",value:x,onChange:e=>m(e.target.value),rows:10}),(0,o.jsx)("button",{type:"button",className:"w-full px-4 py-2 mt-6 border rounded-lg shadow border-neutral-500 text-neutral-900 hover:bg-neutral-100 focus:outline-none dark:border-neutral-800 dark:border-opacity-50 dark:bg-white dark:text-black dark:hover:bg-neutral-300",onClick:()=>{let e={...t,name:s,description:d,content:x.trim()};l(e),r()},children:a("Save")})]})]})})})},tw=e=>{let{prompt:t}=e,{dispatch:r,handleUpdatePrompt:l,handleDeletePrompt:a}=(0,i.useContext)(tj),[s,n]=(0,i.useState)(!1),[d,c]=(0,i.useState)(!1),[u,x]=(0,i.useState)(!1),[m,p]=(0,i.useState)(""),h=e=>{l(e),r({field:"searchTerm",value:""})},f=e=>{e.stopPropagation(),d&&(a(t),r({field:"searchTerm",value:""})),c(!1)},g=e=>{e.stopPropagation(),c(!1)},v=e=>{e.stopPropagation(),c(!0)},b=(e,t)=>{e.dataTransfer&&e.dataTransfer.setData("prompt",JSON.stringify(t))};return(0,i.useEffect)(()=>{u?c(!1):d&&x(!1)},[u,d]),(0,o.jsxs)("div",{className:"relative flex items-center",children:[(0,o.jsxs)("button",{className:"flex w-full cursor-pointer items-center gap-3 rounded-lg p-3 text-sm transition-colors duration-200 hover:bg-[#343541]/90",draggable:"true",onClick:e=>{e.stopPropagation(),n(!0)},onDragStart:e=>b(e,t),onMouseLeave:()=>{c(!1),x(!1),p("")},children:[(0,o.jsx)(tb.Z,{size:18}),(0,o.jsx)("div",{className:"relative max-h-5 flex-1 overflow-hidden text-ellipsis whitespace-nowrap break-all pr-4 text-left text-[12.5px] leading-3",children:t.name})]}),(d||u)&&(0,o.jsxs)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:[(0,o.jsx)(eZ,{handleClick:f,children:(0,o.jsx)(es.Z,{size:18})}),(0,o.jsx)(eZ,{handleClick:g,children:(0,o.jsx)(eE.Z,{size:18})})]}),!d&&!u&&(0,o.jsx)("div",{className:"absolute right-1 z-10 flex text-gray-300",children:(0,o.jsx)(eZ,{handleClick:v,children:(0,o.jsx)(ea.Z,{size:18})})}),s&&(0,o.jsx)(ty,{prompt:t,onClose:()=>n(!1),onUpdatePrompt:h})]})},tk=()=>{let{state:{folders:e}}=(0,i.useContext)(G),{state:{searchTerm:t,filteredPrompts:r},handleUpdatePrompt:l}=(0,i.useContext)(tj),a=(e,t)=>{if(e.dataTransfer){let r=JSON.parse(e.dataTransfer.getData("prompt")),a={...r,folderId:t.id};l(a)}},s=e=>r.filter(e=>e.folderId).map((t,r)=>{if(t.folderId===e.id)return(0,o.jsx)("div",{className:"ml-5 gap-2 border-l pl-2",children:(0,o.jsx)(tw,{prompt:t})},r)});return(0,o.jsx)("div",{className:"flex w-full flex-col pt-2",children:e.filter(e=>"prompt"===e.type).map((e,r)=>(0,o.jsx)(eO,{searchTerm:t,currentFolder:e,handleDrop:a,folderComponent:s(e)},r))})},tN=e=>{let{prompts:t}=e;return(0,o.jsx)("div",{className:"flex w-full flex-col gap-1",children:t.slice().reverse().map((e,t)=>(0,o.jsx)(tw,{prompt:e},t))})},tC={searchTerm:"",filteredPrompts:[]},t_=()=>{let{t:e}=(0,tn.$G)("promptbar"),t=m({initialState:tC}),{state:{prompts:r,defaultModelId:l,showPromptbar:a},dispatch:s,handleCreateFolder:n}=(0,i.useContext)(G),{state:{searchTerm:d,filteredPrompts:c},dispatch:u}=t,x=()=>{s({field:"showPromptbar",value:!a}),localStorage.setItem("showPromptbar",JSON.stringify(!a))},p=()=>{if(l){let e={id:(0,tf.Z)(),name:"Prompt ".concat(r.length+1),description:"",content:"",model:g[l],folderId:null},t=[...r,e];s({field:"prompts",value:t}),_(t)}},h=e=>{let t=r.filter(t=>t.id!==e.id);s({field:"prompts",value:t}),_(t)},f=e=>{let t=r.map(t=>t.id===e.id?e:t);s({field:"prompts",value:t}),_(t)},v=e=>{if(e.dataTransfer){let t=JSON.parse(e.dataTransfer.getData("prompt")),r={...t,folderId:e.target.dataset.folderId};f(r),e.target.style.background="none"}};return(0,i.useEffect)(()=>{d?u({field:"filteredPrompts",value:r.filter(e=>{let t=e.name.toLowerCase()+" "+e.description.toLowerCase()+" "+e.content.toLowerCase();return t.includes(d.toLowerCase())})}):u({field:"filteredPrompts",value:r})},[d,r]),(0,o.jsx)(tj.Provider,{value:{...t,handleCreatePrompt:p,handleDeletePrompt:h,handleUpdatePrompt:f},children:(0,o.jsx)(tp,{side:"right",isOpen:a,addItemButtonTitle:e("New prompt"),itemComponent:(0,o.jsx)(tN,{prompts:c.filter(e=>!e.folderId)}),folderComponent:(0,o.jsx)(tk,{}),items:c,searchTerm:d,handleSearchTerm:e=>u({field:"searchTerm",value:e}),toggleOpen:x,handleCreateItem:p,handleCreateFolder:()=>n(e("New folder"),"prompt"),handleDrop:v})})},tS={closeSite:!0,inited:!1,userInfo:null,apiKey:"",loading:!1,pluginKeys:[],lightMode:"dark",messageIsStreaming:!1,modelError:null,models:[],folders:[],conversations:[],selectedConversation:void 0,currentMessage:void 0,prompts:[],showPromptbar:!1,showChatbar:!0,currentFolder:void 0,messageError:!1,searchTerm:"",defaultModelId:void 0,serverSideApiKeyIsSet:!1,serverSidePluginKeysSet:!1};var tI=r(25675),tP=r.n(tI);let tE=()=>{let e=(0,e2.useRouter)(),{t}=(0,c.$G)("common"),{fetchUser:r}=eN(),{dispatch:l}=(0,i.useContext)(G),[a,s]=(0,i.useState)(!0),n=()=>{s(!0),window.localStorage.setItem("promotioned","true")};return(0,e1.Z)(async()=>{s(!!window.localStorage.getItem("promotioned")),await r(),l({field:"inited",value:!0})}),!a&&e.query.ch?(0,o.jsx)("div",{className:(0,V.Z)(eW().chargeModal,"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50"),children:(0,o.jsx)("div",{className:"fixed inset-0 z-10 overflow-y-auto",children:(0,o.jsxs)("div",{className:"flex min-h-screen items-center justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[(0,o.jsx)("div",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true"}),(0,o.jsxs)("div",{className:(0,V.Z)(eW().modal,"dark:border-netural-400 inline-block transform overflow-hidden rounded-lg border border-gray-300 text-left align-bottom text-neutral-200 shadow-xl transition-all sm:my-8 sm:max-h-[600px] sm:w-full sm:align-middle"),style:{width:"340px"},role:"dialog",children:[(0,o.jsx)("div",{className:(0,V.Z)(eW().header,"justify-end"),children:(0,o.jsx)("button",{className:(0,V.Z)(eW().close,"absolute right-1.5"),onClick:n,children:(0,o.jsx)(eE.Z,{size:24})})}),(0,o.jsxs)("div",{className:(0,V.Z)(eW().body,"flex flex-col items-center"),children:[(0,o.jsx)("p",{className:"mb-2.5 text-base text-center mx-3",children:t("Scan qrcode")}),(0,o.jsx)(tP(),{width:"250",height:"250",alt:"qrcode",src:"https://resource.close-ai.work/kefu.jpg"})]}),(0,o.jsx)("div",{className:"h-4"})]})]})})}):null},tT=()=>{let e=h(),[t,r]=(0,i.useState)(""),l=async()=>{let t=await e.get("/api/site");(null==t?void 0:t.data)&&r(t.data)};return{site:t,fetchSite:l}},tZ=()=>{let{site:e,fetchSite:t}=tT(),{t:r}=(0,c.$G)("chat"),{state:{closeSite:l},dispatch:a}=(0,i.useContext)(G);return(0,i.useEffect)(()=>{a({field:"closeSite",value:!e})},[e,a]),(0,e1.Z)(t),e&&!l?(0,o.jsxs)("div",{className:(0,V.Z)(tc().site,"fixed flex w-full justify-center h-10 items-center"),children:[(0,o.jsxs)("span",{className:tc().cont,children:[r("Website publishing page"),": ",(0,o.jsx)("a",{className:"inline underline text-white",href:e,target:"_blank",children:e})]}),(0,o.jsx)("div",{className:(0,V.Z)(tc().close,"absolute"),children:(0,o.jsx)("button",{className:tc().btn,onClick:()=>a({field:"closeSite",value:!0}),children:(0,o.jsx)(eE.Z,{size:18})})})]}):null},tO=e=>{let{serverSideApiKeyIsSet:t,serverSidePluginKeysSet:r,defaultModelId:l}=e,{t:a}=(0,c.$G)("chat"),{getModels:s}=f(),{getModelsError:n}=p(),u=m({initialState:tS}),{state:{userInfo:h,apiKey:v,lightMode:S,folders:I,conversations:P,selectedConversation:E,models:T,prompts:Z},dispatch:O}=u,L=(0,i.useRef)(!1),{data:z,error:D,refetch:A}=(0,d.useQuery)(["GetModels",v,t],e=>{let{signal:r}=e;return v||t?s({key:v},r):null},{enabled:!0,refetchOnMount:!1}),{defaultModel:R,isForbiddenGPT4:K,isSupportGPT4:U,warnGPT4:M}=ey({userInfo:h,models:T,defaultModelId:l});(0,i.useEffect)(()=>{z&&O({field:"models",value:z})},[z,O]),(0,i.useEffect)(()=>{O({field:"modelError",value:n(D)})},[O,D,n]);let F=e=>{!U(e)||K(e)?(K(e)&&M(),B(e,{key:"model",value:R})):(O({field:"selectedConversation",value:e}),k(e))},J=(e,t)=>{let r={id:(0,tf.Z)(),name:e,type:t},l=[...I,r];O({field:"folders",value:l}),C(l)},$=e=>{let t=I.filter(t=>t.id!==e);O({field:"folders",value:t}),C(t);let r=P.map(t=>t.folderId===e?{...t,folderId:null}:t);O({field:"conversations",value:r}),N(r);let l=Z.map(t=>t.folderId===e?{...t,folderId:null}:t);O({field:"prompts",value:l}),_(l)},H=(e,t)=>{let r=I.map(r=>r.id===e?{...r,name:t}:r);O({field:"folders",value:r}),C(r)},W=()=>{P[P.length-1];let e={id:(0,tf.Z)(),name:"".concat(a("New Conversation")),messages:[],model:R,prompt:b,folderId:null},t=[...P,e];O({field:"selectedConversation",value:e}),O({field:"conversations",value:t}),k(e),N(t),O({field:"loading",value:!1})},B=(e,t)=>{let r={...e,[t.key]:t.value},{single:l,all:a}=w(r,P);O({field:"selectedConversation",value:l}),O({field:"conversations",value:a})};return(0,i.useEffect)(()=>{window.innerWidth<640&&O({field:"showChatbar",value:!1})},[E]),(0,i.useEffect)(()=>{l&&O({field:"defaultModelId",value:l}),t&&O({field:"serverSideApiKeyIsSet",value:t}),r&&O({field:"serverSidePluginKeysSet",value:r})},[l,t,r]),(0,i.useEffect)(()=>{let e=localStorage.getItem("theme");e&&O({field:"lightMode",value:e});let a=localStorage.getItem("apiKey");t?(O({field:"apiKey",value:""}),localStorage.removeItem("apiKey")):a&&O({field:"apiKey",value:a});let s=localStorage.getItem("pluginKeys");r?(O({field:"pluginKeys",value:[]}),localStorage.removeItem("pluginKeys")):s&&O({field:"pluginKeys",value:s}),function(){let e=navigator.userAgent.toLowerCase(),t=/(iphone|ipod|ipad|android|blackberry|webos|windows phone)/.test(e),r=window.screen.width,l=void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile");return t||r<=768||l}()&&O({field:"showChatbar",value:!1});let n=localStorage.getItem("showChatbar");n&&O({field:"showChatbar",value:"true"===n});let o=localStorage.getItem("showPromptbar");o&&O({field:"showPromptbar",value:"true"===o});let i=localStorage.getItem("folders");i&&O({field:"folders",value:JSON.parse(i)});let d=localStorage.getItem("prompts");d&&O({field:"prompts",value:JSON.parse(d)});let c=localStorage.getItem("conversationHistory");if(c){let e=JSON.parse(c),t=y(e);O({field:"conversations",value:t})}let u=localStorage.getItem("selectedConversation");if(u){let e=JSON.parse(u),t=j(e);F(t)}else O({field:"selectedConversation",value:{id:(0,tf.Z)(),name:"New conversation",messages:[],model:g[l],prompt:b,folderId:null}})},[l,O,t,r]),(0,o.jsxs)(G.Provider,{value:{...u,handleNewConversation:W,handleCreateFolder:J,handleDeleteFolder:$,handleUpdateFolder:H,handleSelectConversation:F,handleUpdateConversation:B},children:[(0,o.jsxs)(x(),{children:[(0,o.jsx)("title",{children:"Liaobots UI"}),(0,o.jsx)("meta",{name:"description",content:"ChatGPT but better."}),(0,o.jsx)("meta",{name:"viewport",content:"height=device-height ,width=device-width, initial-scale=1, user-scalable=no"}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsxs)("main",{className:"flex h-screen w-screen flex-col text-sm text-white dark:text-white ".concat(S),children:[(0,o.jsx)(tE,{}),(0,o.jsx)(tZ,{}),E&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{className:"fixed top-0 w-full sm:hidden",children:(0,o.jsx)(tv,{selectedConversation:E,onNewConversation:W})}),(0,o.jsxs)("div",{className:"flex h-full w-full pt-[48px] sm:pt-0",children:[(0,o.jsx)(tg,{}),(0,o.jsx)("div",{className:"flex flex-1",children:(0,o.jsx)(eC,{stopConversationRef:L})}),(0,o.jsx)(t_,{})]})]})]})]})};var tG=tO,tL=!0},48669:function(e){e.exports={safe:"Chat_safe__jlQ_f",textareaLoading:"Chat_textareaLoading__44k9e",code:"Chat_code__y6WXR",inlineIcon:"Chat_inlineIcon__TqGNI"}},34537:function(e){e.exports={relative:"MySettings_relative__wn8T_",modal:"MySettings_modal__QrBkv"}},35977:function(e){e.exports={chargeModal:"UserInfo_chargeModal__VxDh9",modal:"UserInfo_modal__jyr1g",header:"UserInfo_header__G1TB3",close:"UserInfo_close__Dtwwg",body:"UserInfo_body__NbEt3",title:"UserInfo_title__jWSsa",price_p:"UserInfo_price_p__BuHnL",radio:"UserInfo_radio__Fe0rz",radioItem:"UserInfo_radioItem__RdY51",selected:"UserInfo_selected__mPZRa",list:"UserInfo_list__uLhXd",item:"UserInfo_item__PU_pa",radioText:"UserInfo_radioText__WLVa9",giftText:"UserInfo_giftText__dDpqH",radioMsg:"UserInfo_radioMsg__JpGWe",itemSelected:"UserInfo_itemSelected__OAHuR",footer:"UserInfo_footer__IAe19",pay:"UserInfo_pay__EoSHk"}},68225:function(e){e.exports={site:"site_site__opyXF",close:"site_close__UPzFV","top-12_5":"site_top-12_5__dzvIJ"}}},function(e){e.O(0,[879,751,774,888,179],function(){return e(e.s=48312)}),_N_E=e.O()}]);